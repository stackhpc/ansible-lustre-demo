# Configure the lustre filesystem with some demo projects
- name: Create project directories and files
  file: "{{ item }}"
  loop:
    - path: /mnt/lustre/tenants
      state: directory
      owner: root
      group: root
    - path: /mnt/lustre/tenants/srcp-foo
      state: directory
      owner: "{{ ansible_user }}"
      group: "{{ ansible_user }}"
    - path: /mnt/lustre/tenants/srcp-bar
      state: directory
      owner: "{{ ansible_user }}"
      group: "{{ ansible_user }}"
    - path: /mnt/lustre/csd3
      state: directory
      owner: root
      group: root
    - path: /mnt/lustre/csd3/project
      state: directory
      owner: root
      group: root
    - path: /mnt/lustre/csd3/project/baz # <- this is what demo-nfs-client mounts over NFS
      state: directory
      owner: bazowner
      group: bazowner
      mode: ug=rx,o=
    - path: /mnt/lustre/csd3/project/baz/readwrite
      state: directory
      owner: bazowner
      group: bazowner
      mode: ug=rwx,o=
    - path: /mnt/lustre/csd3/project/baz/readonly
      state: directory
      owner: bazowner
      group: bazowner
      mode: ug=rx,o=
    - path: /mnt/lustre/csd3/project/qux
      state: directory
      owner: "{{ ansible_user }}"
      group: "{{ ansible_user }}"
- name: Create example NFS-exported read-only file
  copy:
    dest: /mnt/lustre/csd3/project/baz/readonly/readme.txt
    content: |
      hello world!

    owner: baz1
    group: bazowner
    mode: ug=r
